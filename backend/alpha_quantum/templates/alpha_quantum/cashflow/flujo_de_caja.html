{% extends "alpha_quantum/layout.html" %}
{% block content %}
<style>
    /* Fondo y color de la cabecera */
    .table thead th {
        background-color: #1a1a1a !important;
        color: white !important;
        border-color: #444 !important;
    }

    /* Filas impares (striped) */
    .table-striped tbody tr:nth-of-type(odd) td {
        background-color: #242424 !important;
        color: white !important;
    }

    /* Filas pares */
    .table-striped tbody tr:nth-of-type(even) td {
        background-color: #1a1a1a !important;
        color: white !important;
    }

    /* Hover fila */
    .table-striped tbody tr:hover td {
        background-color: #333 !important;
    }

    /* Enlaces dentro de la tabla */
    .table td a {
        color: #fff !important;
    }

    /* Bordes y formularios */
    .form-control,
    .form-select {
        background-color: #1e1e1e;
        color: #fff;
        border-color: #444;
    }

    .form-control::placeholder {
        color: #aaa;
    }
</style>
<div class="container mt-4">
    <h2>Flujo de Caja Mensual</h2>
    <div class="mb-3">
        <button class="btn btn-outline-light me-2" onclick="filtrar('todos')">Todos</button>
        <button class="btn btn-outline-success me-2" onclick="filtrar('ingresos')">Ingresos</button>
        <button class="btn btn-outline-danger me-2" onclick="filtrar('gastos')">Gastos</button>
        <button class="btn btn-outline-warning me-2" onclick="filtrar('propiedades')">Propiedades</button>
        <button class="btn btn-outline-info me-2" onclick="filtrar('prestamos')">Préstamos</button>
    </div>
    <div class="row text-center mb-4">
        <div class="col-md-3 mb-2">
            <div class="card shadow-sm border-0" style="background-color: #e8f5e9;">
                <div class="card-body">
                    <i class="fas fa-arrow-down fa-2x text-success mb-2"></i>
                    <h6 class="card-title fw-bold text-success">Ingresos</h6>
                    <p class="card-text fs-5">{{ total_ingresos }} €</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-2">
            <div class="card shadow-sm border-0" style="background-color: #ffebee;">
                <div class="card-body">
                    <i class="fas fa-arrow-up fa-2x text-danger mb-2"></i>
                    <h6 class="card-title fw-bold text-danger">Gastos</h6>
                    <p class="card-text fs-5">{{ total_gastos }} €</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-2">
            <div class="card shadow-sm border-0" style="background-color: #fff8e1;">
                <div class="card-body">
                    <i class="fas fa-home fa-2x text-warning mb-2"></i>
                    <h6 class="card-title fw-bold text-warning">Gastos Alquiler</h6>
                    <p class="card-text fs-5">{{ total_gastos_alquiler }} €</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-2">
            <div class="card shadow-sm border-0" style="background-color: #e3f2fd;">
                <div class="card-body">
                    <i class="fas fa-wallet fa-2x text-primary mb-2"></i>
                    <h6 class="card-title fw-bold text-primary">Balance Total</h6>
                    <p class="card-text fs-5">{{ balance_total }} €</p>
                </div>
            </div>
        </div>
    </div>
    <div id="ingresos" class="seccion">
        <h4>Ingresos / Gastos</h4>
        <button class="btn btn-success mb-2" data-bs-toggle="modal" data-bs-target="#modalIngreso">+ Añadir Ingreso</button>
        <button class="btn btn-danger mb-2 ms-2" data-bs-toggle="modal" data-bs-target="#modalGasto">+ Añadir Gasto</button>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Categoría</th>
                    <th>Monto</th>
                    <th>Descripción</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for r in registros %}
                <tr>
                    <td>{{ r.date }}</td>
                    <td>{{ r.category|title }}</td>
                    <td>{{ r.tipo_ingreso|default_if_none:"-" }}</td>
                    <td>{{ r.amount }} €</td>
                    <td>{{ r.description }}</td>
                    <td><a href="{% url 'editar_registro' r.id %}" class="btn btn-sm btn-primary">Editar</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div id="propiedades" class="seccion mt-5">
        <div class="d-flex justify-content-between align-items-center">
            <h4>Propiedades en Alquiler</h4>
            <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#modalPropiedad">+ Añadir Propiedad</button>
        </div>
        <table class="table table-striped mt-2">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Ingreso</th>
                    <th>Hipoteca</th>
                    <th>Meses Restantes</th>
                    <th>Mantenimiento</th>
                    <th>Beneficio Neto</th>
                </tr>
            </thead>
            <tbody>
                {% for p in propiedades %}
                <tr>
                    <td>{{ p.nombre }}</td>
                    <td>{{ p.ingreso_mensual }} €</td>
                    <td>{{ p.hipoteca_mensual }} €</td>
                    <td>{{ p.meses_restantes_hipoteca }}</td>
                    <td>{{ p.gastos_mantenimiento }} €</td>
                    <td>{{ p.beneficio_neto }} €</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div id="prestamos" class="seccion mt-5">
        <div class="d-flex justify-content-between align-items-center">
            <h4>Préstamos Personales</h4>
            <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#modalPrestamo">+ Añadir Préstamo</button>
        </div>
        <table class="table table-striped mt-2">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Cuota Mensual</th>
                    <th>Meses Restantes</th>
                    <th>Balance Pendiente</th>
                </tr>
            </thead>
            <tbody>
                {% for p in prestamos %}
                <tr>
                    <td>{{ p.nombre }}</td>
                    <td>{{ p.cuota_mensual }} €</td>
                    <td>{{ p.meses_restantes }}</td>
                    <td>{{ p.balance_actual }} €</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modales necesarios -->
{% include 'alpha_quantum/cashflow/modales_ingreso_gasto.html' %}
{% include 'alpha_quantum/cashflow/modal_propiedad.html' %}
{% include 'alpha_quantum/cashflow/modal_prestamo.html' %}

<script>
    function filtrar(seccion) {
        const secciones = ['ingresos', 'propiedades', 'prestamos'];
        secciones.forEach(id => {
            document.getElementById(id).style.display = (seccion === 'todos' || seccion === id) ? 'block' : 'none';
        });
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
